services:
  # Frontend Service (Next.js)
  - type: web
    name: municollect-frontend
    env: node
    region: singapore
    buildCommand: |
      export NODE_OPTIONS="--max-old-space-size=4096"
      npm install --force
      npm run build:frontend
    startCommand: npm run start:frontend
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: NEXT_TELEMETRY_DISABLED
        value: 1
      - key: SKIP_ENV_VALIDATION
        value: true
    healthCheckPath: /

  # Backend Service (Go)
  - type: web
    name: municollect-backend
    env: go
    region: singapore
    buildCommand: |
      cd apps/backend
      go mod download
      go build -o bin/server ./cmd/server
    startCommand: cd apps/backend && ./bin/server
    envVars:
      - key: PORT
        value: 10000
      - key: GO_ENV
        value: production
    healthCheckPath: /health

databases:
  - name: municollect-db
    region: singapore
    plan: free
